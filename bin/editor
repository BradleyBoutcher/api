#!/bin/bash -e

# Run from top-level dir
cd "$(dirname "$0")"

if [ ! -z "$(pwd)/destiny.yml" ]; then 
    echo "Please run `bin/bundle` before attempting to use this utility."
    exit 1
fi

echo "Starting Swagger editor on port 9090..."
docker run -d --rm \
    -v $(pwd):/work \
     -p 9090:8080  \
     -e SWAGGER_FILE=/work/destiny.yml \
     --name destiny-editor \
     swaggerapi/swagger-editor

echo -n "Waiting for editor to start..."
until [ "$(docker inspect -f {{.State.Running}} destiny-editor)"=="true" ]; do
    sleep 0.1;
    echo "."
done

echo
echo "Visit http://localhost:9090 in your browser to use the Swagger Editor"
